<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFramework>net7.0</TargetFramework>
        <LangVersion>latest</LangVersion>
        <Nullable>enable</Nullable>

        <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
        <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
    </PropertyGroup>

    <PropertyGroup>
        <PackageType>Template</PackageType>
        <PackageId>CelesteMod.Publicizer</PackageId>
        <Title>Celeste Mod publicizer</Title>
        <Authors>EverestAPI</Authors>
        <PackageLicenseExpression>MIT</PackageLicenseExpression>
        <PackageProjectUrl>https://github.com/EverestAPI/CelestePublicizer/blob/master/CelesteMod.Publicizer</PackageProjectUrl>
        <RepositoryUrl>https://github.com/EverestAPI/CelestePublicizer</RepositoryUrl>
        <PackageReleaseNotes>Automated release.</PackageReleaseNotes>
        <Copyright>Copyright (c) 2024 EverestAPI</Copyright>
        <Description>Build task to publicize vanilla Celeste..</Description>
        <PackageTags>publicizer;celeste;mod;game</PackageTags>
        <TargetFramework>net7.0</TargetFramework>
        <IncludeContentInPack>true</IncludeContentInPack>
        <IncludeBuildOutput>false</IncludeBuildOutput>
        <ContentTargetFolders>content</ContentTargetFolders>
        <NoDefaultExcludes>true</NoDefaultExcludes>
        <PackageIcon>icon.png</PackageIcon>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="System.Runtime.Loader" Version="4.3.0" />
        <PackageReference Include="Microsoft.Build.Framework" Version="15.1.548"/>
        <PackageReference Include="Microsoft.Build.Utilities.Core" Version="15.1.548"/>
        <PackageReference Include="AsmResolver.DotNet" Version="5.0.0" />
        
        <!-- This dependency is only required to provide the IgnoresAccessChecksToAttribute -->
        <PackageReference Include="BepInEx.AssemblyPublicizer.MSBuild" Version="0.4.1" PrivateAssets="all" />
        <Publicize Include="BepInEx.AssemblyPublicizer.MSBuild" PublicizeTarget="All" />
    </ItemGroup>

    <ItemGroup>
        <EmbeddedResource Include="Assets\**\*" />
        <Content Include="$(MSBuildProjectName).props" Pack="true" PackagePath="build"/>
        <None Include="..\README.md;icon.png" Pack="true" PackagePath="\"/>
    </ItemGroup>

    <Target Name="PackTaskDependencies" BeforeTargets="GenerateNuspec">
        <ItemGroup>
            <_PackageFiles Include="$(OutputPath)CelesteMod.Publicizer.dll;$(OutputPath)AsmResolver*.dll">
                <PackagePath>build</PackagePath>
                <Visible>false</Visible>
                <BuildAction>Content</BuildAction>
            </_PackageFiles>
        </ItemGroup>
    </Target>
</Project>
